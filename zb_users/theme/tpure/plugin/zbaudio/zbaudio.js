!function(h){"use strict";var o={autoPlay:!1,error:function(t){console.log("\u266a zbaudio: "+t)}},n=[];function i(t,i){this.$box=h(t),this.id=this.$box.data("audioid"),this.cfg=h.extend({},o,i),this.$audio=null,this.$img=this.$box.find(".zbaudio_img"),this.$play=this.$box.find('[data-action="play"]'),this.$bar=this.$box.find(".zbaudio_bar"),this.$now=this.$box.find(".zbaudio_now"),this.$cur=this.$box.find(".zbaudio_current"),this.$tot=this.$box.find(".zbaudio_total"),this.dragging=!1,this.init(),n.push(this)}i.prototype={init:function(){var i=this,t=this.cfg.song[0];this.$audio=h('<audio preload="metadata"></audio>').attr("id","audio_"+this.id).on("loadedmetadata",function(){i.$tot.text(i.timeFmt(this.duration))}).on("progress",function(){var t;this.duration&&this.buffered.length&&(t=this.buffered.end(this.buffered.length-1)/this.duration*100,i.$box.find(".zbaudio_cache").css("width",t.toFixed(2)+"%"))}).on("timeupdate",function(){i.dragging||i.setProgress(this.currentTime,this.duration)}).on("ended",function(){i.reset()}).on("error",function(){i.cfg.error("error\uff1a"+t.src)}).appendTo("body"),this.$audio[0].src=t.src,t.cover&&this.$img.empty().append(h("<img>").attr("src",t.cover).css({width:"100%",height:"100%",objectFit:"cover"})),this.$box.find("strong").text(t.title),this.$box.find(".zbaudio_singer").text(t.singer),this.$play.on("click",function(){i.toggle()}),this.bindDrag(),this.cfg.autoPlay&&this.play()},toggle:function(){this.$audio[0].paused?this.play():this.pause()},play:function(){h.each(n,function(t,i){i!==this&&i.pause()}.bind(this)),this.$audio[0].play(),this.$play.addClass("playing")},pause:function(){this.$audio[0].pause(),this.$play.removeClass("playing")},reset:function(){this.$audio[0].currentTime=0,this.$play.removeClass("playing")},bindDrag:function(){var i=this,o=h(document),n="touchmove mousemove",a="touchend mouseup mouseleave",s=i.$box.find(".zbaudio_progress");function e(t){t=((-1!==t.type.indexOf("touch")?t.originalEvent.touches[0]:t).pageX-s.offset().left)/s.width(),t=Math.max(0,Math.min(1,t));i.$now.css("width",(100*t).toFixed(2)+"%")}function u(t){i.dragging&&(t=((-1!==t.type.indexOf("touch")?t.originalEvent.changedTouches[0]:t).pageX-s.offset().left)/s.width(),t=Math.max(0,Math.min(1,t)),i.$audio[0].currentTime=t*i.$audio[0].duration,i.dragging=!1,o.off(n,e).off(a,u))}s.on("touchstart mousedown",function(t){t.preventDefault(),i.dragging=!0,o.on(n,e).on(a,u),e(t)})},setProgress:function(t,i,o){i=0<i?t/i*100:0;this.$now.css("width",i.toFixed(2)+"%"),o||this.$cur.text(this.timeFmt(t))},timeFmt:function(t){var i=Math.floor(t/60),t=Math.floor(t%60);return(i<10?"0":"")+i+":"+(t<10?"0":"")+t},loadFile:function(t){this.cfg.autoPlay=!!t,this.cfg.autoPlay&&this.play()}},h.fn.zbaudio=function(t){return this.each(function(){new i(this,t)})}}(jQuery);